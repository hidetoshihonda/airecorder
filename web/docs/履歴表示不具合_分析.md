# σ▒Ñµ¡┤Φí¿τñ║πü«Σ╕ìσà╖σÉê - σÄƒσ¢áσêåµ₧Éπü¿σ»╛τ¡û

## ≡ƒôà τÖ║τöƒµùÑµÖé
2026σ╣┤2µ£ê6µùÑ

## ≡ƒö┤ σòÅΘíîπü«µªéΦªü
- Θî▓Θƒ│πéÆΣ┐¥σ¡ÿπüÖπéïπü¿πÇîΣ┐¥σ¡ÿσ«îΣ║åπÇìπü¿Φí¿τñ║πüòπéîπéï
- πüùπüïπüùσ▒Ñµ¡┤πâÜπâ╝πé╕πü½πü»Σ╜òπééΦí¿τñ║πüòπéîπü¬πüä
- APIπü½πü»µ¡úσ╕╕πü½πâçπâ╝πé┐πüîΣ┐¥σ¡ÿπüòπéîπüªπüäπéï∩╝ê9Σ╗╢τó║Φ¬ìµ╕êπü┐∩╝ë

---

## ≡ƒöì σÄƒσ¢áσêåµ₧É

### Φ¬┐µƒ╗τ╡Éµ₧£

#### 1. APIπâ¼πé╣πâ¥πâ│πé╣πü«τó║Φ¬ì
```
GET /api/recordings/list?userId=temp-user-001
```

**πâ¼πé╣πâ¥πâ│πé╣µºïΘÇá:**
```json
{
  "success": true,
  "data": {
    "items": [...],     // ΓåÉ Θî▓Θƒ│πâçπâ╝πé┐πü«Θàìσêù
    "total": 9,
    "page": 1,
    "limit": 20,
    "hasMore": false
  }
}
```

#### 2. recordingsApi.ts πü« request πâíπé╜πââπâë
```typescript
// Line 71-72
return {
  data: data.data || data,  // APIπâ¼πé╣πâ¥πâ│πé╣πü« data Θâ¿σêåπéÆΦ┐öπüÖ
};
```

πüôπéîπü½πéêπéè `recordingsApi.listRecordings()` πü«µê╗πéèσÇñπü»:
```typescript
{
  data: {
    items: [...],
    total: 9,
    page: 1,
    ...
  }
}
```

#### 3. history/page.tsx πü«πâçπâ╝πé┐σçªτÉå∩╝êσòÅΘíîτ«çµëÇ∩╝ë
```typescript
// Line 65-68
const items = Array.isArray(response.data)
  ? response.data
  : response.data.data || [];  // Γ¥î ΘûôΘüòπüä∩╝ü
setRecordings(items);
```

### ≡ƒÉ¢ µá╣µ£¼σÄƒσ¢á
**`response.data.data` πéÆσÅéτàºπüùπüªπüäπéïπüîπÇüµ¡úπüùπüÅπü» `response.data.items`**

| σÅéτàºπâæπé╣ | σÇñ | τ╡Éµ₧£ |
|---------|-----|------|
| `response.data` | `{items: [...], total: 9, ...}` | πé¬πâûπé╕πéºπé»πâê |
| `response.data.data` | `undefined` | Γ¥î τ⌐║Θàìσêùπü½πü¬πéï |
| `response.data.items` | `[...9Σ╗╢πü«Θî▓Θƒ│...]` | Γ£à µ¡úπüùπüä |

---

## ≡ƒôè σ╜▒Θƒ┐τ»äσ¢▓

### σ╜▒Θƒ┐πéÆσÅùπüæπéïπâòπéíπéñπâ½
| πâòπéíπéñπâ½ | σòÅΘíî | σ╜▒Θƒ┐ |
|---------|------|------|
| `src/app/history/page.tsx` | `response.data.data` πéÆσÅéτàº | σ▒Ñµ¡┤πüîΦí¿τñ║πüòπéîπü¬πüä |

### σ╜▒Θƒ┐πéÆσÅùπüæπü¬πüäΘâ¿σêå
- Θî▓Θƒ│µ⌐ƒΦâ╜ Γ£à
- Σ┐¥σ¡ÿµ⌐ƒΦâ╜∩╝êAPIσæ╝πü│σç║πüù∩╝ëΓ£à
- πâçπâ╝πé┐πâÖπâ╝πé╣Σ┐¥σ¡ÿ Γ£à
- τ┐╗Φ¿│µ⌐ƒΦâ╜ Γ£à

---

## Γ£à σ»╛τ¡û

### σì│µÖéσ»╛σ┐£∩╝êπé│πâ╝πâëΣ┐«µ¡ú∩╝ë

**Σ┐«µ¡úτ«çµëÇ: `src/app/history/page.tsx`**

```typescript
// Before (Line 65-68)
const items = Array.isArray(response.data)
  ? response.data
  : response.data.data || [];

// After
const items = Array.isArray(response.data)
  ? response.data
  : response.data.items || [];
```

**σÉîµºÿπü«Σ┐«µ¡úπüîσ┐àΦªüπü¬τ«çµëÇ:**
- Line 65-68 (useEffectσåà)
- Line 80-83 (fetchRecordingsσåà)

### σåìτÖ║Θÿ▓µ¡óτ¡û

#### 1. σ₧ïσ«Üτ╛⌐πü«σÄ│µá╝σîû
`PaginatedResponse<T>` πü«σ₧ïπéÆµÿÄτñ║τÜäπü½Σ╜┐τö¿πüùπÇüπé│πâ│πâæπéñπâ½µÖéπü½πé¿πâ⌐πâ╝πéÆµñ£σç║πüºπüìπéïπéêπüåπü½πüÖπéïπÇé

```typescript
interface PaginatedResponse<T> {
  items: T[];      // ΓåÉ µÿÄτó║πü½ items
  total: number;
  page: number;
  limit: number;
  hasMore: boolean;
}
```

#### 2. API πâ¼πé╣πâ¥πâ│πé╣σçªτÉåπü«τ╡▒Σ╕Ç
σà▒ΘÇÜπü«πâÿπâ½πâæπâ╝Θûóµò░πéÆΣ╜£µêÉ:

```typescript
function extractItems<T>(response: ApiResponse<PaginatedResponse<T>>): T[] {
  if (response.error || !response.data) return [];
  return response.data.items || [];
}
```

#### 3. πâªπâïπââπâêπâåπé╣πâêπü«Φ┐╜σèá
σ▒Ñµ¡┤πâÜπâ╝πé╕πü«πâçπâ╝πé┐σÅûσ╛ùπâ¡πé╕πââπé»πü½πâåπé╣πâêπéÆΦ┐╜σèáπÇé

#### 4. πâçπâÉπââπé░πâ¡πé░πü«Φ┐╜σèá∩╝êΘûïτÖ║τÆ░σóâπü«πü┐∩╝ë
API πâ¼πé╣πâ¥πâ│πé╣πü«µºïΘÇáπéÆπâ¡πé░σç║σè¢πüùπÇüΣ╕ìµò┤σÉêπéÆµù⌐µ£ƒτÖ║ΦªïπÇé

---

## ≡ƒô¥ Σ┐«µ¡úσ╛îπü«τó║Φ¬ìΘáàτ¢«

- [x] σ₧ïσ«Üτ╛⌐πéÆΣ┐«µ¡ú∩╝ê`PaginatedResponse.data` ΓåÆ `PaginatedResponse.items`∩╝ë
- [x] σ▒Ñµ¡┤πâÜπâ╝πé╕πü«πâçπâ╝πé┐σÅûσ╛ùπâ¡πé╕πââπé»πéÆΣ┐«µ¡ú
- [x] πâôπâ½πâëµêÉσèƒ
- [x] πâçπâùπâ¡πéñσ«îΣ║å
- [ ] σ▒Ñµ¡┤πâÜπâ╝πé╕πüºπâçπâ╝πé┐πüîΦí¿τñ║πüòπéîπéïπüôπü¿
- [ ] µñ£τ┤óµ⌐ƒΦâ╜πüîσïòΣ╜£πüÖπéïπüôπü¿
- [ ] σëèΘÖñµ⌐ƒΦâ╜πüîσïòΣ╜£πüÖπéïπüôπü¿

---

## ≡ƒöº σ«ƒµû╜πüùπüƒΣ┐«µ¡ú

### 1. σ₧ïσ«Üτ╛⌐πü«Σ┐«µ¡ú (`src/types/index.ts`)
```typescript
// Before
export interface PaginatedResponse<T> {
  data: T[];
  pageSize: number;
  ...
}

// After
export interface PaginatedResponse<T> {
  items: T[];  // APIπâ¼πé╣πâ¥πâ│πé╣πü½σÉêπéÅπü¢πüªΣ┐«µ¡ú
  limit: number;  // pageSize ΓåÆ limit πü½Σ┐«µ¡ú
  ...
}
```

### 2. σ▒Ñµ¡┤πâÜπâ╝πé╕πü«Σ┐«µ¡ú (`src/app/history/page.tsx`)
```typescript
// Before
const items = response.data.data || [];

// After
const items = response.data.items || [];
```

---

## ≡ƒôÜ µòÖΦ¿ô

1. **APIπâ¼πé╣πâ¥πâ│πé╣πü«µºïΘÇáπéÆτó║Φ¬ìπüÖπéï** - σ«ƒΘÜ¢πü«πâ¼πé╣πâ¥πâ│πé╣πü¿πé│πâ╝πâëπü«µ£ƒσ╛àσÇñπüîΣ╕ÇΦç┤πüùπüªπüäπéïπüï
2. **σ₧ïσ«Üτ╛⌐πéÆµ┤╗τö¿πüÖπéï** - TypeScriptπü«σ₧ïπâüπéºπââπé»πüºΣ╕ìµò┤σÉêπéÆµù⌐µ£ƒτÖ║Φªï
3. **E2Eπâåπé╣πâêπü«ΘçìΦªüµÇº** - Σ┐¥σ¡ÿΓåÆσ▒Ñµ¡┤Φí¿τñ║πü«Σ╕ÇΘÇúπü«πâòπâ¡πâ╝πéÆπâåπé╣πâê

---

# Φ┐╜σèáΣ╕ìσà╖σÉê: JSONπâæπâ╝πé╣πé¿πâ⌐πâ╝

## ≡ƒôà τÖ║τöƒµùÑµÖé
2026σ╣┤2µ£ê6µùÑ∩╝êσ▒Ñµ¡┤Φí¿τñ║Σ┐«µ¡úσ╛î∩╝ë

## ≡ƒö┤ σòÅΘíîπü«µªéΦªü
```
Failed to execute 'json' on 'Response': Unexpected end of JSON input
```
- σ▒Ñµ¡┤πü»Φí¿τñ║πüòπéîπéïπéêπüåπü½πü¬πüúπüƒ
- Θî▓Θƒ│Φ⌐│τ┤░πâÜπâ╝πé╕πüºπÇîσ▒Ñµ¡┤πü½µê╗πéïπÇìπéÆµè╝πüÖΘÜ¢πü½πé¿πâ⌐πâ╝τÖ║τöƒ

---

## ≡ƒöì σÄƒσ¢áσêåµ₧É

### Φ¬┐µƒ╗τ╡Éµ₧£

#### 1. πé¿πâ⌐πâ╝τÖ║τöƒτ«çµëÇ
`recordingsApi.ts` πü« `request` πâíπé╜πââπâë (Line 64):
```typescript
const data = await response.json();  // ΓåÉ πüôπüôπüºπé¿πâ⌐πâ╝
```

#### 2. σòÅΘíîπü«πé│πâ╝πâë
```typescript
private async request<T>(endpoint: string, options: RequestInit = {}): Promise<ApiResponse<T>> {
  try {
    const response = await fetch(url, { ... });
    const data = await response.json();  // τäíµ¥íΣ╗╢πüºJSONπâæπâ╝πé╣
    // ...
  } catch (error) {
    return { error: (error as Error).message || "Network error" };
  }
}
```

### ≡ƒÉ¢ µá╣µ£¼σÄƒσ¢á
**`response.json()` πéÆτäíµ¥íΣ╗╢πüºσæ╝πéôπüºπüäπéïπüîπÇüΣ╗ÑΣ╕ïπü«πé▒πâ╝πé╣πüºτ⌐║πâ¼πé╣πâ¥πâ│πé╣πü½πü¬πéï:**

| πé▒πâ╝πé╣ | τè╢µ│ü | πâ¼πé╣πâ¥πâ│πé╣πâ£πâçπéú |
|--------|------|-----------------|
| 204 No Content | DELETEµêÉσèƒπü¬πü⌐ | τ⌐║ |
| πâìπââπâêπâ»πâ╝πé»πé¿πâ⌐πâ╝ | µÄÑτ╢Üµû¡ | τ⌐║πü╛πüƒπü»Σ╕ìσ«îσà¿ |
| CORSπé¿πâ⌐πâ╝ | πâùπâ¬πâòπâ⌐πéñπâêσñ▒µòù | πéóπé»πé╗πé╣Σ╕ìσÅ» |
| πé┐πéñπâáπéóπéªπâê | Θüàσ╗╢ | τ⌐║πü╛πüƒπü»Σ╕ìσ«îσà¿ |

### σ╜▒Θƒ┐πéÆσÅùπüæπéïπâòπéíπéñπâ½
| πâòπéíπéñπâ½ | σòÅΘíî |
|---------|------|
| `src/services/recordingsApi.ts` | `request()` πüºτäíµ¥íΣ╗╢JSON.parse |
| `src/services/blobApi.ts` | σÉîµºÿπü«σòÅΘíî |
| `src/services/summaryApi.ts` | σÉîµºÿπü«σòÅΘíî |

---

## Γ£à σ»╛τ¡û

### Σ┐«µ¡úµû╣Θç¥
1. **πâ¼πé╣πâ¥πâ│πé╣πâ£πâçπéúπü«σ¡ÿσ£¿τó║Φ¬ì** - `Content-Length` πü╛πüƒπü» `response.text()` πüºτó║Φ¬ì
2. **σ«ëσà¿πü¬JSONπâæπâ╝πé╣** - try-catchπüºπâæπâ╝πé╣πé¿πâ⌐πâ╝πéÆπâÅπâ│πâëπâ¬πâ│πé░
3. **τ⌐║πâ¼πé╣πâ¥πâ│πé╣σ»╛σ┐£** - 204πü¬πü⌐πü«σá┤σÉêπü»τ⌐║πé¬πâûπé╕πéºπé»πâêπéÆΦ┐öπüÖ

### Σ┐«µ¡úπé│πâ╝πâë
```typescript
private async request<T>(endpoint: string, options: RequestInit = {}): Promise<ApiResponse<T>> {
  const url = `${this.baseUrl}${endpoint}`;

  try {
    const response = await fetch(url, {
      ...options,
      headers: {
        "Content-Type": "application/json",
        ...options.headers,
      },
    });

    // τ⌐║πâ¼πé╣πâ¥πâ│πé╣πü«πâÅπâ│πâëπâ¬πâ│πé░
    const text = await response.text();
    let data: any = null;
    
    if (text) {
      try {
        data = JSON.parse(text);
      } catch (parseError) {
        console.error('[API] JSON parse error:', parseError, 'Response text:', text);
        return { error: 'Invalid JSON response from server' };
      }
    }

    if (!response.ok) {
      return {
        error: data?.error || `HTTP error ${response.status}`,
      };
    }

    return {
      data: data?.data || data,
    };
  } catch (error) {
    console.error('[API] Request error:', error);
    return {
      error: (error as Error).message || "Network error",
    };
  }
}
```

### Σ┐«µ¡úσ»╛Φ▒íπâòπéíπéñπâ½
1. `src/services/recordingsApi.ts` - requestπâíπé╜πââπâë
2. `src/services/blobApi.ts` - getUploadSas, getDownloadSas
3. `src/services/summaryApi.ts` - request πâíπé╜πââπâë∩╝êΦ⌐▓σ╜ôπüÖπéïσá┤σÉê∩╝ë

---

## ≡ƒô¥ σåìτÖ║Θÿ▓µ¡óτ¡û

1. **APIΘÇÜΣ┐íπü«τ╡▒Σ╕Çπâÿπâ½πâæπâ╝Σ╜£µêÉ**
   - σà¿πé╡πâ╝πâôπé╣πüºσÉîπüÿσ«ëσà¿πü¬fetchπâ⌐πââπâæπâ╝πéÆΣ╜┐τö¿
   - πé¿πâ⌐πâ╝πâÅπâ│πâëπâ¬πâ│πé░πéÆΣ╕Çτ«çµëÇπü½Θ¢åτ┤ä

2. **πâ¼πé╣πâ¥πâ│πé╣µñ£Φ¿╝πü«µ¿Öµ║ûσîû**
   - Content-TypeπâÿπââπâÇπâ╝πü«τó║Φ¬ì
   - πé╣πâåπâ╝πé┐πé╣πé│πâ╝πâëπü½σ┐£πüÿπüƒσçªτÉåσêåσ▓É

3. **πâ¡πé░σç║σè¢πü«σ╝╖σîû**
   - ΘûïτÖ║τÆ░σóâπüºAPIπâ¬πé»πé¿πé╣πâê/πâ¼πé╣πâ¥πâ│πé╣πéÆπâ¡πé░σç║σè¢
   - πé¿πâ⌐πâ╝τÖ║τöƒµÖéπü«Φ⌐│τ┤░µâàσá▒Φ¿ÿΘî▓

---

# Φ┐╜σèáΣ╕ìσà╖σÉê: HTTP 404πé¿πâ⌐πâ╝∩╝êΘî▓Θƒ│Φ⌐│τ┤░σÅûσ╛ù∩╝ë

## ≡ƒôà τÖ║τöƒµùÑµÖé
2026σ╣┤2µ£ê6µùÑ∩╝êJSONπâæπâ╝πé╣πé¿πâ⌐πâ╝Σ┐«µ¡úσ╛î∩╝ë

## ≡ƒö┤ σòÅΘíîπü«µªéΦªü
- σ▒Ñµ¡┤πüïπéëΘî▓Θƒ│Φ⌐│τ┤░πéÆΘûïπüÅπü¿πÇîHTTP error 404πÇìπüîτÖ║τöƒ
- APIπü»σ¡ÿσ£¿πüÖπéïπüîπâ½πâ╝πâåπéúπâ│πé░πüîσñ▒µòù

## ≡ƒöì σÄƒσ¢áσêåµ₧É

### Φ¬┐µƒ╗τ╡Éµ₧£
```
GET /api/recordings/{id} ΓåÆ 404 (empty response)
GET /api/recordings/list ΓåÆ 200 OK
```

### ≡ƒÉ¢ µá╣µ£¼σÄƒσ¢á
**Azure Functions V4πüºσÉîπüÿπâ½πâ╝πâêπü½Φñçµò░πü«Θûóµò░πüîτÖ╗Θî▓πüòπéîπüªπüäπüƒ**

σòÅΘíîπü«πé│πâ╝πâë∩╝êΣ┐«µ¡úσëì∩╝ë:
```typescript
// 3πüñπü«Θûóµò░πüîσÉîπüÿπâ½πâ╝πâê "recordings/{id}" πéÆΣ╜┐τö¿
app.http("getRecording", { methods: ["GET"], route: "recordings/{id}" });
app.http("updateRecording", { methods: ["PUT"], route: "recordings/{id}" });
app.http("deleteRecording", { methods: ["DELETE"], route: "recordings/{id}" });
```

Azure Functions V4πüºπü»πÇüσÉîπüÿπâ½πâ╝πâêπü½Φñçµò░πü«Θûóµò░πüîπüéπéïπü¿πâ½πâ╝πâåπéúπâ│πé░πüîΣ╕ìσ«ëσ«Üπü½πü¬πéïπÇé

## Γ£à σ»╛τ¡û

### Σ┐«µ¡úσåàσ«╣
3πüñπü«Θûóµò░πéÆ1πüñπü½τ╡▒σÉê∩╝Ü

```typescript
app.http("recordingById", {
  methods: ["GET", "PUT", "DELETE", "OPTIONS"],
  route: "recordings/{id}",
  handler: async (request) => {
    if (request.method === "GET") { /* GETσçªτÉå */ }
    if (request.method === "PUT") { /* PUTσçªτÉå */ }
    if (request.method === "DELETE") { /* DELETEσçªτÉå */ }
  },
});
```

### Σ┐«µ¡úπâòπéíπéñπâ½
- `api/src/functions/recordings.ts` - Θûóµò░πéÆτ╡▒σÉê

### πâçπâùπâ¡πéñσ╛îπü«τó║Φ¬ì
```
GET /api/recordings/{id} ΓåÆ 200 OK Γ£à
```
