# AIボイスレコーダー＆リアルタイム翻訳アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Azure AI Voice Recorder & Real-time Translator**

### 1.2 プロジェクトの目的
TALIX & DingTalk A1のようなAIボイスレコーダー機能を、Azureクラウドサービスを活用してソフトウェアベースで実現する。音声録音、文字起こし、リアルタイム翻訳、議事録自動作成などの機能を提供する。

### 1.3 対象ユーザー
- ビジネスパーソン（会議の議事録作成）
- 多言語コミュニケーションが必要なユーザー
- インタビュアー・記者
- 学生（講義の記録）
- 語学学習者

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 音声録音機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| REC-001 | 音声録音 | マイクからの音声をリアルタイムで録音 | 必須 |
| REC-002 | 録音一時停止/再開 | 録音中に一時停止・再開が可能 | 必須 |
| REC-003 | 録音保存 | 録音データをローカル/クラウドに保存 | 必須 |
| REC-004 | 録音再生 | 保存した録音データの再生 | 必須 |
| REC-005 | ノイズ除去 | 背景ノイズを除去してクリアな音声を提供 | 推奨 |

#### 2.1.2 音声認識・文字起こし機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| STT-001 | リアルタイム文字起こし | 音声をリアルタイムでテキストに変換 | 必須 |
| STT-002 | 多言語対応 | 10言語をサポート（日本語・英語・スペイン語・中国語・韓国語・フランス語・ドイツ語・ポルトガル語・イタリア語・アラビア語） | 必須 |
| STT-003 | 話者識別 | 複数の話者を識別して区別 | 推奨 |
| STT-004 | 句読点自動挿入 | 文字起こしに自動で句読点を挿入 | 必須 |
| STT-005 | 専門用語辞書 | カスタム辞書による認識精度向上 | 任意 |

#### 2.1.3 リアルタイム翻訳機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| TRN-001 | リアルタイム翻訳 | 文字起こしテキストを即座に翻訳 | 必須 |
| TRN-002 | 多言語翻訳 | 10言語間の相互翻訳をサポート | 必須 |
| TRN-003 | 翻訳言語切替 | 翻訳先言語を簡単に切り替え | 必須 |
| TRN-004 | 双方向翻訳 | 会話形式での双方向翻訳対応 | 推奨 |
| TRN-005 | 翻訳音声出力 | 翻訳結果を音声で読み上げ（TTS） | 推奨 |

#### 2.1.4 議事録・要約機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| SUM-001 | 自動要約 | 会議内容のAI要約を生成 | 必須 |
| SUM-002 | 議事録フォーマット | 構造化された議事録形式で出力 | 必須 |
| SUM-003 | ToDo抽出 | 会話からアクションアイテムを自動抽出 | 推奨 |
| SUM-004 | キーポイント抽出 | 重要なポイントをハイライト | 推奨 |
| SUM-005 | エクスポート機能 | Word, PDF, テキスト形式でエクスポート | 必須 |

### 2.2 補助機能

#### 2.2.1 データ管理機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| DAT-001 | 録音履歴管理 | 過去の録音データを一覧・検索 | 必須 |
| DAT-002 | クラウド同期 | Azure Blob Storageとのデータ同期 | **必須（MVP）** |
| DAT-003 | フォルダ分類 | 録音データのカテゴリ分け | 推奨 |
| DAT-004 | タグ付け | 録音データへのタグ付け機能 | 任意 |
| DAT-005 | テキスト検索 | 文字起こしテキスト内の全文検索 | 推奨 |

#### 2.2.2 ユーザー管理機能
| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| USR-001 | ユーザー認証 | Azure AD B2Cによるユーザー認証 | **必須（MVP）** |
| USR-002 | 設定管理 | ユーザー設定の保存・読込 | 必須 |
| USR-003 | 使用量表示 | APIの使用量・残量の表示 | 推奨 |

---

## 3. 使用するAzureサービス

### 3.1 音声・AI系サービス

| サービス名 | 用途 | 備考 |
|-----------|------|------|
| **Azure Speech Services** | 音声認識（Speech-to-Text）、音声合成（Text-to-Speech）、話者識別 | リアルタイムストリーミング対応 |
| **Azure Translator** | テキストの多言語翻訳 | 90以上の言語をサポート |
| **Azure OpenAI Service** | 要約生成、ToDo抽出、議事録作成 | GPT-4モデルを使用 |

### 3.2 インフラ・ストレージ系サービス

| サービス名 | 用途 | 備考 |
|-----------|------|------|
| **Azure Blob Storage** | 音声ファイル・文字起こしデータの保存 | ホットアクセス層を使用 |
| **Azure Cosmos DB** | メタデータ・ユーザーデータの保存 | NoSQLデータベース、サーバーレスモード |
| **Azure Functions** | バックエンドAPI処理 | サーバーレス |
| **Azure Static Web Apps** | Next.js Webアプリケーションホスティング | SSR/SSG/ISR対応、GitHub Actions自動連携、無料枠あり |

### 3.3 セキュリティ・認証系サービス

| サービス名 | 用途 | 備考 |
|-----------|------|------|
| **Azure AD B2C** | ユーザー認証・管理 | ソーシャルログイン対応 |
| **Azure Key Vault** | APIキー・シークレット管理 | セキュアな認証情報管理 |

#### Azure AD B2C 認証の仕組み（詳細説明）

**Azure AD B2C とは？**

Azure AD B2C（Business to Consumer）は、一般ユーザー（消費者）向けの認証サービスです。
通常の Azure AD（企業の従業員向け）とは異なり、**誰でもアカウントを作成してサービスを利用できます**。

**一般ユーザーの登録・ログイン方法**

```
┌─────────────────────────────────────────────────────────────┐
│                    ログイン画面                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐  │
│   │  📧 メールアドレスで登録/ログイン                      │  │
│   │     - メールアドレス + パスワードで新規登録            │  │
│   │     - メール確認リンクで本人確認                       │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
│   ────────────────── または ──────────────────             │
│                                                             │
│   ┌─────────────────────────────────────────────────────┐  │
│   │  🔗 ソーシャルアカウントでログイン                     │  │
│   │     [Google で続ける]                                 │  │
│   │     [Apple で続ける]                                  │  │
│   │     [Microsoft で続ける]                              │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**認証フロー（ユーザー視点）**

| ステップ | ユーザーの操作 | 裏側の処理 |
|---------|---------------|-----------|
| 1 | アプリの「ログイン」ボタンをクリック | Azure AD B2C のログインページにリダイレクト |
| 2 | メール+パスワード入力、または Google 等を選択 | Azure AD B2C が認証処理を実行 |
| 3 | 初回のみ：メール確認 or ソーシャル認証許可 | ユーザー情報を Azure AD B2C に保存 |
| 4 | 自動的にアプリに戻る | アクセストークン（JWT）を取得 |
| 5 | アプリを利用開始 | トークンで API リクエストを認証 |

**メリット（なぜ Azure AD B2C を使うのか）**

| 項目 | 説明 |
|------|------|
| **パスワード管理不要** | パスワードのハッシュ化・保存は Azure が担当。漏洩リスクを軽減 |
| **ソーシャルログイン** | Google, Apple, Microsoft アカウントで簡単にログイン可能 |
| **セキュリティ機能** | 多要素認証(MFA)、不正アクセス検知、パスワードリセットを標準提供 |
| **スケーラビリティ** | 数百万ユーザーまで対応可能 |
| **コンプライアンス** | GDPR, SOC2 等のセキュリティ基準に準拠 |

**技術的な実装イメージ（Next.js）**

```
[ユーザー] → [Next.js アプリ] → [Azure AD B2C] → [認証完了]
                                      ↓
                               [JWTトークン発行]
                                      ↓
              [Next.js アプリ] ← トークン受け取り
                    ↓
              [Azure Functions API] → トークン検証 → [データアクセス]
```

**想定する認証オプション**

| 認証方式 | 対応 | 備考 |
|---------|------|------|
| メール + パスワード | ✅ | 基本認証。メール確認必須 |
| Google アカウント | ✅ | OAuth 2.0 連携 |
| Apple ID | ✅ | iOS ユーザー向け |
| Microsoft アカウント | ✅ | Outlook, Hotmail ユーザー向け |
| 電話番号 (SMS) | 任意 | 追加オプションとして検討 |

**ユーザーデータの保存場所**

| データ種別 | 保存場所 | 説明 |
|-----------|---------|------|
| 認証情報（メール、パスワードハッシュ） | Azure AD B2C | Microsoft が管理。開発者はアクセス不可 |
| プロフィール（表示名など） | Azure AD B2C | カスタム属性として保存可能 |
| アプリデータ（録音、設定など） | Cosmos DB | ユーザー ID で紐付けて保存 |

### 3.4 監視・分析系サービス

| サービス名 | 用途 | 備考 |
|-----------|------|------|
| **Azure Application Insights** | アプリケーション監視・ログ | パフォーマンス分析 |
| **Azure Monitor** | リソース監視 | アラート設定 |

---

## 4. 非機能要件

### 4.1 パフォーマンス要件
| 項目 | 要件 |
|------|------|
| 音声認識レイテンシ | 500ms以下 |
| 翻訳レイテンシ | 1秒以下 |
| 録音最大時間 | 4時間/セッション |
| 同時接続ユーザー数 | 100ユーザー以上 |

### 4.2 可用性要件
| 項目 | 要件 |
|------|------|
| システム稼働率 | 99.5%以上 |
| データ耐久性 | 99.999999999%（11ナイン） |

### 4.3 セキュリティ要件
| 項目 | 要件 |
|------|------|
| 通信暗号化 | TLS 1.2以上 |
| データ暗号化 | AES-256（保存時） |
| 認証方式 | OAuth 2.0 / OpenID Connect |
| アクセス制御 | RBAC（ロールベースアクセス制御） |

### 4.4 スケーラビリティ要件
| 項目 | 要件 |
|------|------|
| 水平スケーリング | Azure Static Web Apps / Functionsによる自動スケール |
| CDN配信 | Azure Static Web AppsのグローバルCDNによる高速配信 |
| ストレージ拡張 | Blob Storageによる無制限拡張 |

---

## 5. システムアーキテクチャ

### 5.1 アーキテクチャ概要図

```
┌─────────────────────────────────────────────────────────────────┐
│                        クライアント層                            │
│                    ┌─────────────────┐                         │
│                    │    Webアプリ     │                         │
│                    │   (Next.js 15)   │                         │
│                    │   [Docker]       │                         │
│                    └────────┬────────┘                         │
└─────────────────────────────┼───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      ホスティング層 (Azure)                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Azure App Service (Docker)                  │   │
│  │                         ▲                                │   │
│  │                         │ (Pull Image)                   │   │
│  │              Azure Container Registry (ACR)              │   │
│  └─────────────────────────┬───────────────────────────────┘   │
└─────────────────────────────┼───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        API層 (Azure)                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              Azure API Management                        │   │
│  └─────────────────────────┬───────────────────────────────┘   │
│                            │                                    │
│  ┌─────────────┬───────────┼───────────┬─────────────┐         │
│  │             │           │           │             │         │
│  ▼             ▼           ▼           ▼             ▼         │
│ ┌───────┐  ┌───────┐  ┌───────┐  ┌───────┐  ┌───────┐        │
│ │Speech │  │Trans- │  │OpenAI │  │Azure  │  │Azure  │        │
│ │Service│  │lator  │  │Service│  │Funcs  │  │AD B2C │        │
│ └───────┘  └───────┘  └───────┘  └───────┘  └───────┘        │
└─────────────────────────────────────────────────────────────────┘
          │                │                │
          ▼                ▼                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      データ層 (Azure)                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │   Blob      │  │  Cosmos DB  │  │  Key Vault  │             │
│  │  Storage    │  │             │  │             │             │
│  │ (音声データ) │  │(メタデータ)  │  │ (シークレット)│             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 データフロー

```
[マイク入力] 
    │
    ▼
[音声キャプチャ (WebRTC/MediaRecorder)]
    │
    ├──────────────────────────────────┐
    │                                  │
    ▼                                  ▼
[ローカル録音保存]          [Azure Speech Services]
                                       │
                                       ▼
                           [リアルタイム文字起こし]
                                       │
                    ┌──────────────────┼──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
            [Azure Translator]  [Azure OpenAI]    [Cosmos DB保存]
                    │                  │
                    ▼                  ▼
            [翻訳テキスト表示]    [要約・議事録生成]
                    │                  │
                    ▼                  ▼
            [TTS音声出力]        [エクスポート]
```

---

## 6. 画面設計（概要）

### 6.1 主要画面一覧

| 画面ID | 画面名 | 概要 |
|--------|--------|------|
| SCR-001 | ホーム画面 | 録音開始、過去の録音一覧へのアクセス |
| SCR-002 | 録音画面 | リアルタイム録音・文字起こし・翻訳表示 |
| SCR-003 | 録音一覧画面 | 過去の録音データの一覧・検索 |
| SCR-004 | 録音詳細画面 | 録音の再生・文字起こし確認・編集 |
| SCR-005 | 設定画面 | 言語設定、音声設定、アカウント設定 |
| SCR-006 | 議事録画面 | AI生成議事録の表示・編集・エクスポート |

### 6.2 録音画面ワイヤーフレーム

```
┌──────────────────────────────────────────────────────────┐
│  ◀ 戻る                AIレコーダー              ⚙ 設定  │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                    │ │
│  │              リアルタイム文字起こし                  │ │
│  │                                                    │ │
│  │  話者A: 本日の会議を始めます。                      │ │
│  │  話者B: よろしくお願いします。                      │ │
│  │  話者A: まずは前回の振り返りから...                 │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                    │ │
│  │              翻訳テキスト (English)                 │ │
│  │                                                    │ │
│  │  Speaker A: Let's start today's meeting.           │ │
│  │  Speaker B: Nice to meet you.                      │ │
│  │  Speaker A: First, let's review the last...        │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  入力言語: [日本語 ▼]      翻訳言語: [English ▼]        │
│                                                          │
│                    ⏱ 00:05:32                           │
│                                                          │
│              ┌─────┐  ┌─────┐  ┌─────┐                 │
│              │ ⏸  │  │ 🔴 │  │ ⏹  │                 │
│              │一時停止│  │ 録音中 │  │ 停止 │                 │
│              └─────┘  └─────┘  └─────┘                 │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 7. 技術スタック

### 7.1 フロントエンド

#### Framework & Core
| 項目 | 技術 | バージョン |
|------|------|-----------|
| Webフレームワーク | Next.js (App Router) | 15 |
| UIライブラリ | React | 19 |
| 言語 | TypeScript | 5.7 |

#### Styling
| 項目 | 技術 | 用途 |
|------|------|------|
| CSSフレームワーク | Tailwind CSS | ユーティリティファーストCSS |
| アニメーション | tailwindcss-animate | Tailwind用アニメーションユーティリティ |
| クラスマージ | tailwind-merge | Tailwindクラスのマージ |
| バリアント管理 | class-variance-authority (CVA) | コンポーネントバリアント構築 |
| 条件付きクラス | clsx | 条件付きクラス名ユーティリティ |

#### UI Components
| 項目 | 技術 | 用途 |
|------|------|------|
| コンポーネントプリミティブ | Radix UI | ヘッドレス・アクセシブルコンポーネント |
| | - Accordion, Checkbox, Collapsible | |
| | - Dialog, Dropdown Menu, Label | |
| | - Progress, Radio Group, Select | |
| | - Slot, Tabs, Tooltip | |
| アイコン | Lucide React | アイコンライブラリ |

#### Forms & Validation
| 項目 | 技術 | 用途 |
|------|------|------|
| フォーム管理 | React Hook Form | フォーム状態管理 |
| バリデーションリゾルバー | @hookform/resolvers | バリデーション連携 |
| スキーマバリデーション | Zod | 型安全なスキーマバリデーション |

#### Data Visualization & Audio
| 項目 | 技術 | 用途 |
|------|------|------|
| チャート | Recharts | データ可視化・グラフ表示 |
| 音声処理 | Web Audio API | 音声キャプチャ・処理 |
| 録音 | MediaRecorder API | 音声録音 |
| リアルタイム通信 | WebSocket (Azure Web PubSub) | リアルタイムデータ同期 |

### 7.2 バックエンド

| 項目 | 技術 |
|------|------|
| ランタイム | Node.js 20 LTS または Python 3.11 |
| フレームワーク | Azure Functions (Serverless) |
| API仕様 | OpenAPI 3.0 / REST |

### 7.3 開発ツール

| 項目 | 技術 |
|------|------|
| IDE | Visual Studio Code |
| バージョン管理 | Git + GitHub |
| CI/CD | GitHub Actions |
| コンテナ | Docker, Docker Compose |
| コンテナレジストリ | Azure Container Registry (ACR) |
| テスト | Jest（フロントエンド）, Pytest（バックエンド）, Playwright（E2E） |
| テスト環境 | ローカル開発環境のみ（ステージング環境は不要） |
| コード品質 | ESLint, Prettier |

### 7.4 ローカル開発環境（Docker Compose）

Docker Composeを使用して、ローカル開発環境を構築します。

**コンテナ構成:**

| コンテナ名 | 役割 | ポート |
|-----------|------|--------|
| **web** | Next.js Webアプリケーション | 3000 |
| **api** | バックエンドAPI（Azure Functions相当） | 7071 |
| **cosmos-emulator** | Cosmos DBエミュレーター（オプション） | 8081 |
| **azurite** | Azure Storageエミュレーター | 10000-10002 |

**docker-compose.yml 概要:**
```yaml
version: '3.8'
services:
  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
    volumes:
      - ./web:/app
      - /app/node_modules
    depends_on:
      - api

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    ports:
      - "7071:7071"
    environment:
      - AZURE_FUNCTIONS_ENVIRONMENT=Development
    volumes:
      - ./api:/app

  azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    ports:
      - "10000:10000"  # Blob
      - "10001:10001"  # Queue
      - "10002:10002"  # Table
```

**ローカル起動コマンド:**
```bash
# 開発環境の起動
docker-compose up -d

# ログの確認
docker-compose logs -f

# 停止
docker-compose down
```

### 7.5 CI/CD パイプライン（GitHub Actions）

#### デプロイフロー概要

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         CI/CD パイプライン                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [開発者] ──Push──▶ [GitHub Repository]                                    │
│                            │                                                │
│                            ▼                                                │
│                    [GitHub Actions]                                         │
│                            │                                                │
│              ┌─────────────┼─────────────┐                                 │
│              │             │             │                                 │
│              ▼             ▼             ▼                                 │
│         [Lint]        [Test]       [Build]                                 │
│         ESLint        Jest          Docker                                 │
│         Prettier      Playwright    Image                                  │
│              │             │             │                                 │
│              └─────────────┼─────────────┘                                 │
│                            │                                                │
│                            ▼ (テスト成功時のみ)                              │
│              [Azure Container Registry (ACR)]                               │
│                            │                                                │
│                            ▼ (ACRトリガー)                                   │
│                   [Azure App Service]                                       │
│                    (自動デプロイ)                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### CI/CD ワークフロー詳細

| ステップ | 処理内容 | トリガー |
|---------|---------|----------|
| **1. コードプッシュ** | mainブランチへのプッシュ/マージ | 開発者のgit push |
| **2. CI: Lint** | ESLint, Prettierによるコード品質チェック | ワークフロー自動実行 |
| **3. CI: テスト** | Jest（単体）, Playwright（E2E）の実行 | Lint成功後 |
| **4. Build** | Dockerイメージのビルド | テスト成功後 |
| **5. Push to ACR** | イメージをACRにプッシュ | ビルド成功後 |
| **6. CD: デプロイ** | App Serviceが新イメージを自動検知・デプロイ | ACRへのプッシュ |

#### GitHub Actions ワークフロー例

```yaml
# .github/workflows/deploy.yml
name: Build and Deploy

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  ACR_NAME: acr-airecorder
  IMAGE_NAME: airecorder-web

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Lint
        run: npm run lint
      
      - name: Test
        run: npm run test

  build-and-deploy:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
      
      - name: Login to ACR
        run: az acr login --name ${{ env.ACR_NAME }}
      
      - name: Build and push Docker image
        run: |
          docker build -t ${{ env.ACR_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} .
          docker push ${{ env.ACR_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}
          docker tag ${{ env.ACR_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }} \
                     ${{ env.ACR_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest
          docker push ${{ env.ACR_NAME }}.azurecr.io/${{ env.IMAGE_NAME }}:latest
```

#### 認証・セキュリティ

| 認証方式 | 用途 | 設定場所 |
|---------|------|----------|
| **サービスプリンシパル** | GitHub ActionsからAzureへのアクセス | GitHub Secrets (`AZURE_CREDENTIALS`) |
| **マネージドID** | App ServiceからACRへのイメージプル | Azure Portal（App Service設定） |
| **ACRトークン** | ACRへのイメージプッシュ | GitHub Actions経由（az acr login） |

---

## 8. API設計（主要エンドポイント）

### 8.1 音声処理API

```
POST   /api/speech/start-session     # 音声認識セッション開始
POST   /api/speech/transcribe        # 音声ファイルの文字起こし
DELETE /api/speech/session/{id}      # セッション終了
```

### 8.2 翻訳API

```
POST   /api/translate                # テキスト翻訳
GET    /api/translate/languages      # サポート言語一覧
```

### 8.3 録音管理API

```
GET    /api/recordings               # 録音一覧取得
GET    /api/recordings/{id}          # 録音詳細取得
POST   /api/recordings               # 録音データ保存
PUT    /api/recordings/{id}          # 録音データ更新
DELETE /api/recordings/{id}          # 録音データ削除
GET    /api/recordings/{id}/download # 録音ファイルダウンロード
```

### 8.4 議事録API

```
POST   /api/summary/generate         # 議事録・要約生成
GET    /api/summary/{recordingId}    # 議事録取得
POST   /api/summary/export           # エクスポート（PDF/Word）
```

---

## 9. データモデル

### 9.1 Recording（録音データ）

```json
{
  "id": "uuid",
  "userId": "uuid",
  "title": "会議録音 2026-02-04",
  "createdAt": "2026-02-04T10:00:00Z",
  "duration": 3600,
  "audioUrl": "https://storage.blob.../audio.wav",
  "sourceLanguage": "ja-JP",
  "transcript": {
    "segments": [
      {
        "speaker": "Speaker 1",
        "text": "本日の会議を始めます",
        "startTime": 0.0,
        "endTime": 2.5
      }
    ]
  },
  "translations": {
    "en": {
      "segments": [...]
    }
  },
  "summary": {
    "overview": "...",
    "keyPoints": [...],
    "actionItems": [...]
  },
  "tags": ["会議", "プロジェクトA"],
  "folderId": "uuid"
}
```

### 9.2 User（ユーザー）

```json
{
  "id": "uuid",
  "email": "user@example.com",
  "displayName": "山田太郎",
  "settings": {
    "defaultSourceLanguage": "ja-JP",
    "defaultTargetLanguage": "en",
    "autoSaveToCloud": true,
    "noiseSuppression": true
  },
  "subscription": {
    "plan": "premium",
    "usageThisMonth": {
      "speechMinutes": 120,
      "translationCharacters": 50000
    }
  }
}
```

---

## 10. 開発フェーズ・スケジュール

### Phase 1: MVP（Minimum Viable Product）- 5週間

| 週 | タスク |
|----|--------|
| Week 1 | 環境構築、Azure リソースセットアップ（全サービス）、基本UI作成 |
| Week 2 | ユーザー認証（Azure AD B2C）実装 |
| Week 3 | 音声録音機能、Azure Speech Services連携、Azure Blob Storage保存 |
| Week 4 | リアルタイム文字起こし、翻訳機能実装（10言語対応） |
| Week 5 | 録音一覧機能、テスト・バグ修正 |

**MVP機能範囲（全機能を初期から実装）:**
- ✅ ユーザー認証（Azure AD B2C）
- ✅ 音声録音・再生
- ✅ リアルタイム文字起こし
- ✅ リアルタイム翻訳（10言語対応：日本語・英語・スペイン語・中国語・韓国語・フランス語・ドイツ語・ポルトガル語・イタリア語・アラビア語）
- ✅ 録音データのクラウド保存（Azure Blob Storage）
- ✅ 録音一覧表示

### Phase 2: 機能拡張 - 3週間

| 週 | タスク |
|----|--------|
| Week 6 | AI要約・議事録機能（Azure OpenAI）実装 |
| Week 7 | 話者識別、エクスポート機能実装 |
| Week 8 | パフォーマンス最適化、全言語の品質テスト |

### Phase 3: 品質向上・リリース準備 - 2週間

| 週 | タスク |
|----|--------|
| Week 9 | セキュリティ監査、負荷テスト |
| Week 10 | ドキュメント整備、本番環境デプロイ |

### Phase 4: 追加機能（必要に応じて実装）

| 機能 | 説明 | トリガー |
|------|------|----------|
| オフライン対応 | 接続切断時のローカル一時保存・後で同期 | 使用時に不便を感じた場合 |
| ノイズ除去強化 | 高度なノイズキャンセリング | 音声認識精度に問題がある場合 |
| カスタム辞書 | 専門用語の登録機能 | 特定業界での利用が増えた場合 |

---

## 11. 概算コスト（Azure）

### 11.1 月額コスト見積もり（1ユーザー・個人利用想定）

| サービス | 使用量想定 | 月額コスト（USD） | 月額コスト（JPY）※ |
|---------|-----------|------------------|-------------------|
| Azure Speech Services | 300分/月 | $4.80 | ¥720 |
| Azure Translator | 200K文字/月 | $2 | ¥300 |
| Azure OpenAI Service | 50K トークン/月 | $1.50 | ¥225 |
| Azure Blob Storage | 5GB | $0.10 | ¥15 |
| Azure Cosmos DB | 400 RU/s (最小) | $25 | ¥3,750 |
| Azure Functions | 10万実行 | $0 (無料枠内) | ¥0 |
| Azure AD B2C | 1 MAU | $0 (無料枠内) | ¥0 |
| Azure Static Web Apps | Free プラン | $0 | ¥0 |
| **合計** | | **約 $33/月** | **約 ¥5,000/月** |

※ 為替レート: 1 USD = 150 JPY で計算（実際のレートにより変動）

**💡 コスト削減のヒント:**

| 項目 | 方法 | 削減効果 |
|------|------|---------|
| Cosmos DB | Azure Table Storage に変更 | ¥3,750 → ¥50以下 |
| Speech Services | 無料枠（5時間/月）を活用 | 無料枠内なら ¥0 |
| 開発環境 | Azure 無料アカウント（初年度クレジット付き） | 12ヶ月間一部無料 |

**最小構成（無料枠最大活用）の場合: 約 ¥500〜1,000/月 も可能**

※ 実際のコストは使用量により変動します

---

## 12. リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 音声認識精度が低い | 高 | カスタム音声モデルの作成、ノイズ除去の強化 |
| レイテンシが大きい | 高 | エッジ処理の併用、リージョン最適化 |
| APIコストの増大 | 中 | 使用量監視、キャッシュ活用、クォータ設定 |
| セキュリティ脆弱性 | 高 | 定期的なセキュリティ監査、暗号化徹底 |
| 多言語対応の品質 | 中 | 主要言語から段階的に対応、品質評価の実施 |

---

## 13. 今後の拡張案

1. **モバイルアプリ対応** - React Native/Flutterでのネイティブアプリ開発（将来対応）
2. **デスクトップアプリ対応** - Electron/Tauriでのデスクトップアプリ化（将来対応）
3. **オフライン対応** - ローカル音声認識モデルの統合
4. **会議ツール連携** - Teams, Zoom, Google Meetとの連携
4. **カスタム用語辞書** - 業界・企業固有の用語登録
5. **音声コマンド** - 音声での操作対応
6. **共有・コラボレーション** - チームでの議事録共有機能

---

## 14. 付録

### 14.1 対応言語

初期リリースから10言語に対応します。アーキテクチャは多言語対応を前提に設計されており、将来的な言語追加も容易です。

| 言語 | 音声認識コード | 翻訳コード | 地域/備考 |
|------|---------------|------------|-----------|
| 日本語 | ja-JP | ja | 日本 |
| 英語 | en-US | en | アメリカ（デフォルト） |
| スペイン語 | es-ES | es | スペイン（デフォルト） |
| 中国語（簡体） | zh-CN | zh-Hans | 中国本土 |
| 韓国語 | ko-KR | ko | 韓国 |
| フランス語 | fr-FR | fr | フランス |
| ドイツ語 | de-DE | de | ドイツ |
| ポルトガル語 | pt-BR | pt | ブラジル |
| イタリア語 | it-IT | it | イタリア |
| アラビア語 | ar-SA | ar | サウジアラビア（RTL対応） |

**言語選択の設計方針:**
- UIでは言語名をネイティブ表記で表示（例: 日本語、English、Español、中文）
- 音声認識とテキスト翻訳で同じ言語設定を共有
- ユーザー設定で「デフォルト入力言語」「デフォルト翻訳先言語」を保存

**RTL（右から左）言語対応:**
- アラビア語のテキスト表示は `dir="rtl"` で対応
- UIレイアウト全体のRTL対応は将来検討

**将来追加候補:**
- ヒンディー語 (hi-IN)
- ロシア語 (ru-RU)
- ベトナム語 (vi-VN)
- タイ語 (th-TH)
- インドネシア語 (id-ID)

### 14.2 参考リンク

- [Azure Speech Services ドキュメント](https://docs.microsoft.com/azure/cognitive-services/speech-service/)
- [Azure Translator ドキュメント](https://docs.microsoft.com/azure/cognitive-services/translator/)
- [Azure OpenAI Service ドキュメント](https://docs.microsoft.com/azure/cognitive-services/openai/)

---

## 15. 追加確認事項・決定事項

### 15.1 UI/デザイン方針

**参考サイト:** [Distinction（Atsueigo）](https://distinction.atsueigo.com/)

| デザイン要素 | 方針 |
|-------------|------|
| **全体のトーン** | クリーンでミニマル、モダンな印象 |
| **背景色** | 白ベース（ライトテーマのみ） |
| **タイポグラフィ** | 大きめで読みやすいフォント、十分な行間 |
| **レイアウト** | カードベースUI、十分な余白（ホワイトスペース重視） |
| **アクセント** | 控えめな色使い、重要な要素のみ強調 |
| **ダークモード** | 初期リリースでは対応しない |

**デザインの特徴:**
- 視認性を最優先としたシンプルなレイアウト
- 情報の階層が明確で、ユーザーが迷わないUI
- アニメーションは控えめに、必要な箇所のみ適用
- モバイルファーストだが、デスクトップでも快適に使えるレスポンシブデザイン

### 15.2 技術決定事項

#### 録音ファイル形式

| 項目 | 決定 | 理由 |
|------|------|------|
| **ファイル形式** | WebM (Opus codec) | ブラウザネイティブサポート、高圧縮率、良好な音質のバランス |
| **サンプルレート** | 48kHz | 高品質な音声認識に十分な品質 |
| **ビットレート** | 128kbps | 音声録音に最適なサイズと品質のバランス |
| **バックアップ形式** | WAV（オプション） | 非圧縮が必要な場合のみ |

#### ファイルサイズ・セッション制限

| 項目 | 制限値 | 備考 |
|------|--------|------|
| **1回の録音最大時間** | 4時間 | 要件定義書記載通り |
| **最大ファイルサイズ** | 1GB | WebM形式で4時間録音でも約150MB程度のため十分 |
| **同時録音セッション数** | 1セッション | シンプルさ優先。複数録音の必要性が出たら将来対応 |
| **ストレージ保持期間** | 無期限（プラン次第） | 将来的に有料プランで差別化可能 |

#### オフライン対応

| 項目 | MVP | 将来対応 |
|------|-----|---------|
| インターネット接続必須 | ✅ 必須 | - |
| 接続切断時の一時保存 | ❌ 非対応 | 使用時に不便を感じたら実装 |
| ローカル音声認識 | ❌ 非対応 | 将来的にブラウザAPI対応を検討 |

### 15.3 Azureリソースセットアップ手順

開発開始時に以下のAzureリソースをセットアップします：

**Phase 1（Week 1）でセットアップするリソース:**

| No | サービス | リソース名（例） | 設定ポイント |
|----|---------|-----------------|-------------|
| 1 | **リソースグループ** | rg-airecorder-dev | 東日本リージョン（japaneast） |
| 2 | **Azure AD B2C** | airecorder-b2c | ユーザーフロー: サインアップ/サインイン |
| 3 | **Azure Speech Services** | speech-airecorder-dev | F0（無料枠）→ S0（本番） |
| 4 | **Azure Translator** | translator-airecorder-dev | F0（無料枠）→ S1（本番） |
| 5 | **Azure OpenAI Service** | openai-airecorder-dev | GPT-4モデルのデプロイ |
| 6 | **Azure Blob Storage** | stairecorderdev | ホットアクセス層 |
| 7 | **Azure Cosmos DB** | cosmos-airecorder-dev | サーバーレスモード（コスト最適化） |
| 8 | **Azure Functions** | func-airecorder-dev | Node.js 20 LTS、Consumptionプラン |
| 9 | **Azure Static Web Apps** | swa-airecorder-dev | Free SKU、GitHub Actions自動連携 |
| 10 | **Azure Key Vault** | kv-airecorder-dev | シークレット管理 |

**セットアップ順序:**
```
1. リソースグループ作成
2. Key Vault 作成（シークレット保存先として先に準備）
3. Azure AD B2C テナント作成・設定
4. Speech Services, Translator, OpenAI Service 作成
5. Blob Storage, Cosmos DB 作成
6. Azure Functions 作成
7. Azure Static Web Apps 作成
8. GitHub Actions用デプロイトークン取得
9. 各サービスの接続文字列・キーを Key Vault に保存
```

**GitHub Actions用シークレット設定:**

GitHubリポジトリの Settings > Secrets and variables > Actions に以下を設定:

| シークレット名 | 内容 |
|--------------|------|
| `AZURE_STATIC_WEB_APPS_API_TOKEN` | Static Web Appsのデプロイトークン |

**デプロイトークン取得コマンド:**
```bash
az staticwebapp secrets list --name swa-airecorder-dev --query "properties.apiKey" -o tsv
```

### 15.4 環境変数一覧（開発時）

```env
# Azure AD B2C
AZURE_AD_B2C_TENANT_NAME=
AZURE_AD_B2C_CLIENT_ID=
AZURE_AD_B2C_CLIENT_SECRET=

# Azure Speech Services
AZURE_SPEECH_KEY=
AZURE_SPEECH_REGION=japaneast

# Azure Translator
AZURE_TRANSLATOR_KEY=
AZURE_TRANSLATOR_REGION=japaneast

# Azure OpenAI
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_KEY=
AZURE_OPENAI_DEPLOYMENT_NAME=

# Azure Storage
AZURE_STORAGE_CONNECTION_STRING=
AZURE_STORAGE_CONTAINER_NAME=recordings

# Azure Cosmos DB
AZURE_COSMOS_ENDPOINT=
AZURE_COSMOS_KEY=
AZURE_COSMOS_DATABASE=airecorder

# Azure Container Registry (ACR)
ACR_LOGIN_SERVER=
ACR_USERNAME=
ACR_PASSWORD=
```

### 15.5 Dockerファイル構成

**プロジェクトディレクトリ構成:**
```
airecorder/
├── .github/
│   └── workflows/
│       └── deploy.yml          # GitHub Actions ワークフロー
├── web/                        # Next.js フロントエンド
│   ├── Dockerfile
│   ├── .dockerignore
│   ├── package.json
│   └── ...
├── api/                        # Azure Functions バックエンド
│   ├── Dockerfile
│   ├── package.json
│   └── ...
├── docker-compose.yml          # ローカル開発用
├── docker-compose.override.yml # 開発環境の追加設定
└── README.md
```

**web/Dockerfile (Next.js):**
```dockerfile
# ビルドステージ
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# 実行ステージ
FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV=production

# セキュリティ: 非root ユーザーで実行
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs
EXPOSE 3000
ENV PORT 3000

CMD ["node", "server.js"]
```

---

**文書情報**
- 作成日: 2026年2月4日
- 最終更新日: 2026年2月5日
- バージョン: 1.3
- 作成者: AIアシスタント
- 更新履歴:
  - v1.3: Azure App Service → Azure Static Web Appsに変更、ACR削除
